<div class="comments-wrapper">
  
  <button mat-button class="toggle-btn" (click)="toggleComments()">
    <mat-icon class="toggle-icon">{{ isExpanded() ? 'expand_less' : 'chat_bubble_outline' }}</mat-icon>
    <span class="toggle-text">
      {{ isExpanded() ? 'Hide Comments' : 'Comments' }}
    </span>
    @if(allComments().length > 0) {
        <span class="count-badge" >{{ allComments().length }}</span>


    }
  </button>

  @if (isExpanded()) {
    <div class="comments-section">
      
      <div class="comments-list custom-scroll">
        @for (comment of allComments(); track comment.id) {
          <div class="comment-item">
            <div class="avatar-circle">
              {{ comment.author_name?.charAt(0)?.toUpperCase() || 'U' }}
            </div>
            
            <div class="comment-bubble">
              <div class="bubble-header">
                <span class="author-name">{{ comment.author_name || 'Unknown' }}</span>
                <span class="time">{{ comment.created_at | date:'shortTime' }}</span>
              </div>
              <p class="comment-text">{{ comment.body }}</p>
            </div>
          </div>
        } @empty {
          <div class="empty-comments">
            <mat-icon>chat</mat-icon>
            <p>No comments yet. Start the conversation!</p>
          </div>
        }
      </div>

      <div class="add-comment-box">
        <mat-form-field appearance="outline" class="comment-field" subscriptSizing="dynamic">
          <input matInput 
                 type="text" 
                 [ngModel]="newCommentContent()" 
                 (ngModelChange)="newCommentContent.set($event)"
                 placeholder="Write a comment..." 
                 (keyup.enter)="onAddComment()"
                 autocomplete="off">
          
          <button mat-icon-button matSuffix 
                  (click)="onAddComment()" 
                  [disabled]="!newCommentContent().trim()"
                  color="primary"
                  class="send-btn">
            <mat-icon>send</mat-icon>
          </button>
        </mat-form-field>
      </div>

    </div>
  }
</div>